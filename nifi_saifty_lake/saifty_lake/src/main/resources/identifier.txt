drop view if exists ehs_null_tables.sta_v_null_ident_header;
drop view if exists saifty_1_staging.STA_V_CLEAN_IDENT_HEADER;
drop view if exists saifty_1_staging.STA_V_SOURCE_IDENT_HEADER;
drop view if exists ehs_null_tables.sta_v_null_sub_header;
drop view if exists saifty_1_staging.STA_V_CLEAN_SUB_HEADER;
drop view if exists saifty_1_staging.STA_V_SOURCE_SUB_HEADER;
drop view if exists ehs_null_tables.sta_v_null_ident_longtext;
drop view if exists saifty_1_staging.STA_V_CLEAN_IDENT_LONGTEXT;
drop view if exists saifty_1_staging.STA_V_SOURCE_IDENT_LONGTEXT;
drop view if exists ehs_null_tables.sta_v_null_prop_usage;
drop view if exists saifty_1_staging.sta_v_clean_prop_usage;
drop view if exists saifty_1_staging.sta_v_source_prop_usage;
drop view if exists saifty_1_staging.STA_V_TMP_IDENTIFIER;
drop view if exists saifty_1_staging.STA_V_LOGIC_IDENTIFIER;
drop view if exists saifty_1_staging.STA_V_USE_IDENTIFIER;

CREATE VIEW ehs_null_tables.sta_v_null_ident_header
as
select
nullif(`function`, '') `function`,
nullif(LOGLOCKMOD, '') LOGLOCKMOD,
nullif(EXTINFO, '') EXTINFO,
cast(nullif(cast(PRIMARYKEY as string),'')as int) PRIMARYKEY,
cast(nullif(cast(FOREIGNKEY as string),'')as int) FOREIGNKEY,
cast(nullif(cast( FLGPRIMKEY as string),'')as int)  FLGPRIMKEY,
cast(nullif(cast(FLGFRGNKEY as string),'')as int) FLGFRGNKEY,
nullif(CLIENT , '') CLIENT,
cast(nullif(cast(RECORD_NO as string),'')as int) RECORD_NO,
nullif(CHNGSTATUS , '') CHNGSTATUS,
nullif(VALID_FROM , '') VALID_FROM,
nullif(VALID_TO , '') VALID_TO,
  	  	nullif(chang_no, '') chang_no,
  	  	nullif(DEL_IND, '') DEL_IND,
  	  	nullif(PARK_IND, '') PARK_IND,
  	  	nullif(created_on, '') created_on,
  	  	nullif(CREATED_BY, '') CREATED_BY,
		nullif(changd_on, '') changd_on,
		nullif(CHANGD_BY, '') CHANGD_BY,
		nullif(DATAORIGIN, '') DATAORIGIN,
		nullif(DATA_PROV, '') DATA_PROV,
  	  	nullif(ID_TYPE, '') ID_TYPE,
  	  	nullif(ID_CATEGRY, '') ID_CATEGRY,
  	  	RECNO_ROOT,
  	  	nullif(LANGU,'') LANGU,
  	  	nullif(LANGU_ISO,'') LANGU_ISO,
  	  	nullif(cast(IDENTIFIER as VARCHAR(30)), '') IDENTIFIER,
  	  	nullif(NORMED_ID, '') NORMED_ID,
  	  	nullif(LONG_TEXT, '') LONG_TEXT,
  	  	cast(nullif(cast(SEQUENCE as string),'')as int) SEQUENCE,
  	  	nullif(DOC_TYPE, '') DOC_TYPE,
  	  	cast(nullif(cast(DOC_NUMBER as string),'')as int) DOC_NUMBER,
  	  	nullif(DOC_VER, '') DOC_VER,
  	  	nullif(DOC_PART, '') DOC_PART,
  	  	nullif(IS_SOURCE_OF_A_HEREDITY, '') IS_SOURCE_OF_A_HEREDITY,
  	  	nullif(OVERWRITTEN_INHERITED_RECORD, '') OVERWRITTEN_INHERITED_RECORD,
  	  	nullif(EXCLUDED_INHERITED_RECORD, '') EXCLUDED_INHERITED_RECORD,
  	  	nullif(RECNO_TEMPLATE, '') RECNO_TEMPLATE,
  	  	nullif(REF_RECNRI_SOURCE, '') REF_RECNRI_SOURCE,
  	  	nullif(REF_RECNRI_ORIGINAL, '') REF_RECNRI_ORIGINAL,
  	  	nullif(RECNO_ROOT_ORIGINAL, '') RECNO_ROOT_ORIGINAL,
  	  	nullif(TEMPLATE_SEQUENCE, '') TEMPLATE_SEQUENCE,
  	  	nullif(FORMAT_FLAG, '') FORMAT_FLAG,
  	  	nullif(inserted, '') copied,
  	  	nullif(inserted, '') inserted
  	  	from ehs_base_tables.IDENt_HEADER;

CREATE view saifty_1_staging.STA_V_CLEAN_IDENT_HEADER as
  select
      "sys" as SYSTEM,
   `function`,
 LOGLOCKMOD,
 EXTINFO,
PRIMARYKEY,
FOREIGNKEY,
 FLGPRIMKEY,
 FLGFRGNKEY,
 CLIENT,
RECORD_NO,
 CHNGSTATUS,
cast(substring(from_unixtime(unix_timestamp(VALID_FROM, 'yyyy-MM-dd')),1,10) as DATE) VALID_FROM,
cast(substring(from_unixtime(unix_timestamp(VALID_TO, 'MM/dd/yyyy')),1,10) as DATE) VALID_TO,
 CHANG_NO,
 DEL_IND,
 PARK_IND,
cast(substring(from_unixtime(unix_timestamp(Created_on,  'MM/dd/yyyy')),1,10) as DATE) Created_on,
 CREATED_BY,
cast(substring(from_unixtime(unix_timestamp(changd_on,  'MM/dd/yyyy')),1,10) as DATE) changd_on,
 CHANGD_BY,
 DATAORIGIN,
 DATA_PROV,
RECNO_ROOT,
nvl(ID_TYPE,'X') ID_TYPE,
nvl(ID_CATEGRY,'X') ID_CATEGRY,
nvl(trim(LANGU),'E') LANGU,
nvl(LANGU_ISO,'EN') LANGU_ISO,
 IDENTIFIER,
 NORMED_ID,
 LONG_TEXT,
SEQUENCE,
 DOC_TYPE,
DOC_NUMBER,
 DOC_VER,
 DOC_PART,
 IS_SOURCE_OF_A_HEREDITY,
 OVERWRITTEN_INHERITED_RECORD,
 EXCLUDED_INHERITED_RECORD,
 RECNO_TEMPLATE,
 REF_RECNRI_SOURCE,
 REF_RECNRI_ORIGINAL,
 RECNO_ROOT_ORIGINAL,
 TEMPLATE_SEQUENCE,
 FORMAT_FLAG,
cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) COPIED,
cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) inserted
    from ehs_null_tables.sta_v_null_IDENT_HEADER
    left outer join ehs_base_tables.langu
    on(nvl(trim(sta_v_null_IDENT_HEADER.LANGU),'E') = SPRAS)
    where
    PRIMARYKEY is not null and
      RECORD_NO is not null
      and VALID_FROM is not null
      and RECORD_NO > 0
      and (client = '100' or client = '800');

CREATE view saifty_1_staging.STA_V_SOURCE_IDENT_HEADER
as
select distinct SYSTEM,`FUNCTION`,LOGLOCKMOD,EXTINFO,PRIMARYKEY,FOREIGNKEY,FLGPRIMKEY,FLGFRGNKEY,CLIENT,RECORD_NO,CHNGSTATUS,VALID_FROM,VALID_TO,CHANG_NO,DEL_IND,PARK_IND,CREATED_ON,CREATED_BY,CHANGD_ON,CHANGD_BY,DATAORIGIN,DATA_PROV,RECNO_ROOT,ID_TYPE,ID_CATEGRY,LANGU,LANGU_ISO,IDENTIFIER,NORMED_ID,LONG_TEXT,SEQUENCE,DOC_TYPE,DOC_NUMBER,DOC_VER,DOC_PART,IS_SOURCE_OF_A_HEREDITY,OVERWRITTEN_INHERITED_RECORD,EXCLUDED_INHERITED_RECORD,RECNO_TEMPLATE,REF_RECNRI_SOURCE,REF_RECNRI_ORIGINAL,RECNO_ROOT_ORIGINAL,TEMPLATE_SEQUENCE,FORMAT_FLAG,INSERTED
,COPIED
    from saifty_1_staging.STA_V_CLEAN_IDENT_HEADER;


CREATE VIEW  ehs_null_tables.sta_v_null_sub_header
as
select
nullif(`function`, '') `function`,
nullif(LOGLOCKMOD, '') LOGLOCKMOD,
nullif(EXTINFO, '') EXTINFO,
cast(nullif(cast(PRIMARYKEY as string),'')as int) PRIMARYKEY,
cast(nullif(cast(FOREIGNKEY as string),'')as int) FOREIGNKEY,
cast(nullif(cast( FLGPRIMKEY as string),'')as int)  FLGPRIMKEY,
cast(nullif(cast(FLGFRGNKEY as string),'')as int) FLGFRGNKEY,
nullif(CLIENT , '') CLIENT,
cast(nullif(cast(RECORD_NO as string),'')as int) RECORD_NO,
nullif(CHNGSTATUS , '') CHNGSTATUS,
nullif(VALID_FROM , '') VALID_FROM,
nullif(VALID_TO , '') VALID_TO,
nullif(chang_no, '') chang_no,
nullif(DEL_IND, '') DEL_IND,
nullif(PARK_IND , '') PARK_IND ,
nullif(created_on, '') created_on,
nullif(CREATED_BY, '') CREATED_BY,
nullif(changd_on, '') changd_on,
nullif(CHANGD_BY, '') CHANGD_BY,
nullif(DATAORIGIN, '') DATAORIGIN,
nullif(DATA_PROV , '') DATA_PROV ,
cast(nullif(cast(RECNO_ROOT as string),'')as int) RECNO_ROOT,
nullif(SUB_CHGDON , '') SUB_CHGDON,
nullif(SUB_CHGDBY , '') SUB_CHGDBY,
nullif(SUBSTANCE , '') SUBSTANCE,
nullif(SUBCATEGRY , '') SUBCATEGRY,
nullif(SUBAUTHGRP , '') SUBAUTHGRP,
nullif(NOTE , '') NOTE,
nullif(SUBCHARACT , '') SUBCHARACT,
nullif(inserted, '') copied,
nullif(inserted, '') inserted
from
ehs_base_tables.sub_header;

CREATE view saifty_1_staging.STA_V_CLEAN_SUB_HEADER
AS
select
  	  	"sys" as `SYSTEM`,
  	  	`sta_v_null_sub_header`.`function`,
  	  	`sta_v_null_sub_header`.`loglockmod`,
  	  	`sta_v_null_sub_header`.`extinfo`,
  	  	`sta_v_null_sub_header`.`primarykey`,
  	  	`sta_v_null_sub_header`.`foreignkey`,
  	  	`sta_v_null_sub_header`.`flgprimkey`,
  	  	`sta_v_null_sub_header`.`flgfrgnkey`,
  	  	`sta_v_null_sub_header`.`client`,
  	  	`sta_v_null_sub_header`.`record_no`,
  	  	`sta_v_null_sub_header`.`chngstatus`,
  	  	cast(substring(from_unixtime(unix_timestamp(`sta_v_null_sub_header`.`valid_from`, 'yyyy-MM-dd')),1,10) as DATE) `VALID_FROM`,
  	  	cast(substring(from_unixtime(unix_timestamp(`sta_v_null_sub_header`.`valid_to`, 'MM/dd/yyyy')),1,10) as DATE) `VALID_TO`,
  	  	cast(substring(from_unixtime(unix_timestamp(`sta_v_null_sub_header`.`created_on`, 'MM/dd/yyyy')),1,10) as DATE) `Created_on`,
  	  	`sta_v_null_sub_header`.`chang_no` `chang_no`,
  	  	`sta_v_null_sub_header`.`del_ind` `DEL_IND`,
  	  	`sta_v_null_sub_header`.`park_ind` `PARK_IND`,
  	  	`sta_v_null_sub_header`.`created_by` `CREATED_BY`,
  	  	cast(substring(from_unixtime(unix_timestamp(`sta_v_null_sub_header`.`changd_on`, 'MM/dd/yyyy')),1,10) as DATE) `changd_on`,
  	  	`sta_v_null_sub_header`.`changd_by` `CHANGD_BY`,
  	  	`sta_v_null_sub_header`.`dataorigin` `DATAORIGIN`,
  	  	`sta_v_null_sub_header`.`data_prov` `DATA_PROV`,
         `RECNO_ROOT`,
  	  	cast(substring(from_unixtime(unix_timestamp(`sta_v_null_sub_header`.`sub_chgdon`, 'MM/dd/yyyy')),1,10) as DATE) `SUB_CHGDON`,
  	  	`sta_v_null_sub_header`.`sub_chgdby` `SUB_CHGDBY`,
  	  	`sta_v_null_sub_header`.`substance` `SUBSTANCE`,
  	  	`sta_v_null_sub_header`.`subcategry` `SUBCATEGRY`,
  	  	`sta_v_null_sub_header`.`subauthgrp` `SUBAUTHGRP`,
  	  	`sta_v_null_sub_header`.`note` `NOTE`,
  	  	`sta_v_null_sub_header`.`subcharact` `SUBCHARACT`,
  	  	cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'MM/dd/yyyy')),1,10) as DATE) `COPIED`,
  	  	cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'MM/dd/yyyy')),1,10) as DATE) `inserted`
  	  	from `ehs_null_tables`.`sta_v_null_SUB_HEADER`
  	  	where
  	  	`sta_v_null_sub_header`.`primarykey` is not null and
  	  	`sta_v_null_sub_header`.`record_no` is not null
  	  	and `sta_v_null_sub_header`.`valid_from` is not null
  	  	and `sta_v_null_sub_header`.`record_no` > 0
  	  	and `sta_v_null_sub_header`.`subcategry` is not null;

CREATE view saifty_1_staging.STA_V_SOURCE_SUB_HEADER
as
select distinct
SYSTEM,`FUNCTION`,LOGLOCKMOD,EXTINFO,PRIMARYKEY,FOREIGNKEY,FLGPRIMKEY,FLGFRGNKEY,CLIENT,RECORD_NO,CHNGSTATUS,VALID_FROM,VALID_TO,CHANG_NO,DEL_IND,PARK_IND,CREATED_ON,CREATED_BY,CHANGD_ON,CHANGD_BY,DATAORIGIN,DATA_PROV,RECNO_ROOT,SUB_CHGDON,SUB_CHGDBY,SUBSTANCE,SUBCATEGRY,SUBAUTHGRP,NOTE,SUBCHARACT,INSERTED
COPIED from saifty_1_staging.STA_V_CLEAN_SUB_HEADER;

CREATE VIEW ehs_null_tables.sta_v_null_prop_usage
as
select
nullif(`function`, '') `function`,
nullif(LOGLOCKMOD, '') LOGLOCKMOD,
nullif(EXTINFO, '') EXTINFO,
cast(nullif(cast(PRIMARYKEY as string),'')as int) PRIMARYKEY,
cast(nullif(cast(FOREIGNKEY as string),'')as int) FOREIGNKEY,
cast(nullif(cast( FLGPRIMKEY as string),'')as int)  FLGPRIMKEY,
cast(nullif(cast(FLGFRGNKEY as string),'')as int) FLGFRGNKEY,
nullif(CLIENT , '') CLIENT,
cast(nullif(cast(RECORD_NO as string),'')as int) RECORD_NO,
nullif(CHNGSTATUS , '') CHNGSTATUS,
nullif(VALID_FROM , '') VALID_FROM,
nullif(VALID_TO , '') VALID_TO,
nullif(chang_no, '') chang_no,
nullif(DEL_IND, '') DEL_IND,
nullif(PARK_IND , '') PARK_IND ,
nullif(created_on, '') created_on,
nullif(CREATED_BY, '') CREATED_BY,
nullif(changd_on, '') changd_on,
nullif(CHANGD_BY, '') CHANGD_BY,
nullif(DATAORIGIN, '') DATAORIGIN,
nullif(DATA_PROV , '') DATA_PROV ,
cast(nullif(cast(RECNO_ROOT as string),'')as int) RECNO_ROOT,
nullif(MASTERTABL, '') MASTERTABL,
cast(nullif(cast(REF_RECN as string),'')as int) REF_RECN,
nullif(RATING, '') RATING,
nullif(VAL_AREA, '') VAL_AREA,
nullif(ACT_IND, '') ACT_IND,
nullif(REL_IND, '') REL_IND,
nullif(EXCL_IND, '') EXCL_IND,
cast(nullif(cast(REF_RECNRH as string),'')as int) REF_RECNRH,
nullif(inserted, '') copied,
nullif(inserted, '') inserted
from ehs_base_tables.prop_usage;


CREATE view  saifty_1_staging.sta_v_clean_prop_usage
as
select
  	  	"sys" as SYSTEM,
  	  	 `function`,
  	  	 LOGLOCKMOD,
  	  	 EXTINFO,
  	  	PRIMARYKEY,
  	  	FOREIGNKEY,
  	  	 FLGPRIMKEY,
  	  	 FLGFRGNKEY,
  	  	 CLIENT,
  	  	RECORD_NO,
  	  	 CHNGSTATUS,
  	  	cast(substring(from_unixtime(unix_timestamp(VALID_FROM, 'yyyy-MM-dd')),1,10) as DATE) VALID_FROM,
  	  	cast(substring(from_unixtime(unix_timestamp(VALID_TO, 'MM/dd/yyyy')),1,10) as DATE) VALID_TO,
  	  	 CHANG_NO,
  	  	 DEL_IND,
  	  	 PARK_IND,
  	  	cast(substring(from_unixtime(unix_timestamp(Created_on,  'MM/dd/yyyy')),1,10) as DATE) Created_on,
  	  	 CREATED_BY,
  	  	cast(substring(from_unixtime(unix_timestamp(changd_on,  'MM/dd/yyyy')),1,10) as DATE) changd_on,
  	  	 CHANGD_BY,
  	  	DATAORIGIN,
  	  	 DATA_PROV,
  	  	RECNO_ROOT,
  	  	 MASTERTABL,
  	  	cast(REPLACE(LTRIM(REPLACE(REF_RECN,'0', ' ')),' ', '0') as int) REF_RECN,
  	  	 RATING,
  	  	 VAL_AREA,
  	  	ACT_IND,
  	  	REL_IND,
  	  	EXCL_IND,
  	  	REPLACE(LTRIM(REPLACE(REF_RECNRH,'0', ' ')),' ', '0') REF_RECNRH,
  	  	cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) COPIED,
  	  	cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) inserted
  	  	from ehs_null_tables.sta_v_null_prop_usage
  	  	WHERE
  	  	PRIMARYKEY IS NOT NULL AND
  	  	RECORD_NO IS NOT NULL
  	  	AND VALID_FROM IS NOT NULL;
CREATE VIEW ehs_null_tables.sta_v_null_ident_longtext
as
select
  	  	nullif(`function`, '') `function`,
  	  	nullif(LOGLOCKMOD,'') LOGLOCKMOD,
  	  	nullif(EXTINFO,'') EXTINFO,
  	  	cast(nullif(cast(PRIMARYKEY as string),'')as int) PRIMARYKEY,
  	  	cast(nullif(cast(FOREIGNKEY as string),'')as int) FOREIGNKEY,
  	  	nullif(FLGPRIMKEY,'') FLGPRIMKEY,
  	  	nullif(FLGFRGNKEY,'') FLGFRGNKEY,
  	  	cast(nullif(cast(REF_RECNRI as string),'')as int) REF_RECNRI,
  	  	cast(nullif(cast(sequence as string),'')as int) sequence,
  	  	nullif(ref_actnri,'') ref_actnri,
  	  	nullif(FORMAT_COL,'') FORMAT_COL,
  	  	nullif(TEXT_LINE,'') TEXT_LINE,
  	  	nullif(inserted, '') copied,
  	  	nullif(inserted, '') inserted
  	  	from
  	  	ehs_base_tables.ident_longtext;
CREATE view saifty_1_staging.STA_V_CLEAN_IDENT_LONGTEXT
 as
  select
      "sys" as SYSTEM,
   `function`,
 LOGLOCKMOD,
 EXTINFO,
PRIMARYKEY,
FOREIGNKEY,
 FLGPRIMKEY,
 FLGFRGNKEY,
REF_RECNRI,
sequence,
 ref_actnri,
 FORMAT_COL,
 TEXT_LINE,
cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) COPIED,
cast(substring(from_unixtime(unix_timestamp(CURRENT_DATE, 'yyyy-MM-dd')),1,10) as DATE) inserted
    from ehs_null_tables.sta_v_null_ident_longtext
where PRIMARYKEY is not null;

create view saifty_1_staging.STA_V_SOURCE_IDENT_LONGTEXT
as
select distinct SYSTEM,REF_ACTNRI,`FUNCTION`,LOGLOCKMOD,EXTINFO,PRIMARYKEY,FOREIGNKEY,FLGPRIMKEY,FLGFRGNKEY,REF_RECNRI,FORMAT_COL,TEXT_LINE,INSERTED
,COPIED
    from saifty_1_staging.STA_V_CLEAN_IDENT_LONGTEXT;


CREATE view saifty_1_staging.STA_V_TMP_IDENTIFIER
as
  select REF_RECNRI, FLGFRGNKEY, FLGPRIMKEY, FOREIGNKEY, PRIMARYKEY,
      EXTINFO, LOGLOCKMOD,`FUNCTION`, REF_ACTNRI, SYSTEM,
      max(COPIED) COPIED,
     max(INSERTED) INSERTED,
     concat_ws('',collect_list(TEXT_LINE)) TEXT_LINE
    from saifty_1_staging.STA_V_SOURCE_IDENT_LONGTEXT
    group by
      REF_RECNRI, FLGFRGNKEY, FLGPRIMKEY, FOREIGNKEY, PRIMARYKEY,
      EXTINFO, LOGLOCKMOD,`FUNCTION`, REF_ACTNRI, SYSTEM;

CREATE view saifty_1_staging.STA_V_LOGIC_IDENTIFIER
as
  select
      SUHE.SYSTEM SUHE_SYSTEM,
      SUHE.LOGLOCKMOD SUHE_LOGLOCKMOD,
      SUHE.EXTINFO SUHE_EXTINFO,
      SUHE.PRIMARYKEY SUHE_PRIMARYKEY,
      SUHE.FOREIGNKEY SUHE_FOREIGNKEY,
      SUHE.FLGPRIMKEY SUHE_FLGPRIMKEY,
      SUHE.FLGFRGNKEY SUHE_FLGFRGNKEY,
      SUHE.CLIENT SUHE_CLIENT,
      SUHE.RECORD_NO SUHE_RECORD_NO,
      SUHE.CHNGSTATUS SUHE_CHNGSTATUS,
      SUHE.VALID_FROM SUHE_VALID_FROM,
      SUHE.VALID_TO SUHE_VALID_TO,
      SUHE.CHANG_NO SUHE_CHANG_NO,
      SUHE.DEL_IND SUHE_DEL_IND,
      SUHE.PARK_IND SUHE_PARK_IND,
      SUHE.CREATED_ON SUHE_CREATED_ON,
      SUHE.CREATED_BY SUHE_CREATED_BY,
      SUHE.CHANGD_ON SUHE_CHANGD_ON,
      SUHE.CHANGD_BY SUHE_CHANGD_BY,
      SUHE.DATAORIGIN SUHE_DATAORIGIN,
      SUHE.DATA_PROV SUHE_DATA_PROV,
      SUHE.RECNO_ROOT SUHE_RECNO_ROOT,
      SUHE.SUB_CHGDON SUHE_SUB_CHGDON,
      SUHE.SUB_CHGDBY SUHE_SUB_CHGDBY,
      SUHE.SUBSTANCE SUHE_SUBSTANCE,
      SUHE.SUBCATEGRY SUHE_SUBCATEGRY,
      SUHE.SUBAUTHGRP SUHE_SUBAUTHGRP,
      SUHE.NOTE SUHE_NOTE,
      SUHE.SUBCHARACT SUHE_SUBCHARACT,
      SUHE.COPIED SUHE_COPIED,
      IDHE.SYSTEM IDHE_SYSTEM,
      IDHE.LOGLOCKMOD IDHE_LOGLOCKMOD,
      IDHE.EXTINFO IDHE_EXTINFO,
      IDHE.PRIMARYKEY IDHE_PRIMARYKEY,
      IDHE.FOREIGNKEY IDHE_FOREIGNKEY,
      IDHE.FLGPRIMKEY IDHE_FLGPRIMKEY,
      IDHE.FLGFRGNKEY IDHE_FLGFRGNKEY,
      IDHE.CLIENT IDHE_CLIENT,
      IDHE.RECORD_NO IDHE_RECORD_NO,
      IDHE.CHNGSTATUS IDHE_CHNGSTATUS,
      IDHE.VALID_FROM IDHE_VALID_FROM,
      IDHE.VALID_TO IDHE_VALID_TO,
      IDHE.CHANG_NO IDHE_CHANG_NO,
      IDHE.DEL_IND IDHE_DEL_IND,
      IDHE.PARK_IND IDHE_PARK_IND,
      IDHE.CREATED_ON IDHE_CREATED_ON,
      IDHE.CREATED_BY IDHE_CREATED_BY,
      IDHE.CHANGD_ON IDHE_CHANGD_ON,
      IDHE.CHANGD_BY IDHE_CHANGD_BY,
      IDHE.DATAORIGIN IDHE_DATAORIGIN,
      IDHE.DATA_PROV IDHE_DATA_PROV,
      IDHE.RECNO_ROOT IDHE_RECNO_ROOT,
      IDHE.ID_TYPE IDHE_ID_TYPE,
      IDHE.ID_CATEGRY IDHE_ID_CATEGRY,
      IDHE.LANGU IDHE_LANGU,
      IDHE.LANGU_ISO IDHE_LANGU_ISO,
      IDHE.IDENTIFIER IDHE_IDENTIFIER,
      IDHE.NORMED_ID IDHE_NORMED_ID,
      IDHE.LONG_TEXT IDHE_LONG_TEXT,
      IDHE.SEQUENCE IDHE_SEQUENCE,
      IDHE.DOC_TYPE IDHE_DOC_TYPE,
      IDHE.DOC_NUMBER IDHE_DOC_NUMBER,
      IDHE.DOC_VER IDHE_DOC_VER,
      IDHE.DOC_PART IDHE_DOC_PART,
      IDHE.IS_SOURCE_OF_A_HEREDITY IDHE_IS_SOURCE_OF_A_HEREDITY,
      IDHE.OVERWRITTEN_INHERITED_RECORD IDHE_OVERWRITTEN_INHERITED_REC,
      IDHE.EXCLUDED_INHERITED_RECORD IDHE_EXCLUDED_INHERITED_RECORD,
      IDHE.RECNO_TEMPLATE IDHE_RECNO_TEMPLATE,
      IDHE.REF_RECNRI_SOURCE IDHE_REF_RECNRI_SOURCE,
      IDHE.REF_RECNRI_ORIGINAL IDHE_REF_RECNRI_ORIGINAL,
      IDHE.RECNO_ROOT_ORIGINAL IDHE_RECNO_ROOT_ORIGINAL,
      IDHE.TEMPLATE_SEQUENCE IDHE_TEMPLATE_SEQUENCE,
      IDHE.FORMAT_FLAG IDHE_FORMAT_FLAG,
      IDHE.COPIED IDHE_COPIED,
      IDLT.SYSTEM IDLT_SYSTEM,
      IDLT.LOGLOCKMOD IDLT_LOGLOCKMOD,
      IDLT.EXTINFO IDLT_EXTINFO,
      IDLT.PRIMARYKEY IDLT_PRIMARYKEY,
      IDLT.FOREIGNKEY IDLT_FOREIGNKEY,
      IDLT.FLGPRIMKEY IDLT_FLGPRIMKEY,
      IDLT.FLGFRGNKEY IDLT_FLGFRGNKEY,
      IDLT.REF_RECNRI IDLT_REF_RECNRI,
      IDLT.TEXT_LINE IDLT_TEXT_LINE,
      IDLT.REF_ACTNRI IDLT_REF_ACTNRI,
      IDLT.COPIED IDLT_COPIED
    from saifty_1_staging.STA_V_SOURCE_SUB_HEADER SUHE
    left outer join saifty_1_staging.STA_V_SOURCE_IDENT_HEADER IDHE
      on IDHE.RECNO_ROOT = SUHE.RECORD_NO  and IDHE.SYSTEM = SUHE.SYSTEM
    left outer join saifty_1_staging.STA_V_TMP_IDENTIFIER IDLT
      on IDHE.RECORD_NO = IDLT.REF_RECNRI and IDLT.SYSTEM = IDHE.SYSTEM;


CREATE view saifty_1_staging.STA_V_USE_IDENTIFIER
as
  select
      substr(d.SUHE_SYSTEM, 1, 3) SYSTEM, --cast(d.SUHE_SYSTEM as varchar2(3 char)) SYSTEM,
      d.SUHE_RECORD_NO SUB_RECORD_NO,
      d.SUHE_SUBSTANCE SUBSTANCE,
      d.SUHE_CREATED_ON CREATED_ON,
      d.SUHE_CREATED_BY CREATED_BY,
      d.SUHE_CHANGD_ON CHANGD_ON,
      d.SUHE_CHANGD_BY CHANGD_BY,
      d.SUHE_SUBCATEGRY SUBCATEGRY,
      d.SUHE_SUBAUTHGRP SUBAUTHGRP,
      d.SUHE_NOTE NOTE,
      d.SUHE_SUBCHARACT SUBCHARACT,
      d.IDHE_DATAORIGIN DATAORIGIN,
      d.IDHE_ID_TYPE ID_TYPE,
      d.IDHE_ID_CATEGRY ID_CATEGRY,
      d.IDHE_LANGU LANGU,
      d.IDHE_LANGU_ISO LANGU_ISO,
      d.IDHE_IDENTIFIER IDENTIFIER,
      d.IDHE_NORMED_ID NORMED_ID,
      d.IDHE_LONG_TEXT LONG_TEXT,
      d.IDHE_SEQUENCE SEQUENCE,
      d.IDHE_DOC_TYPE DOC_TYPE,
      d.IDHE_DOC_NUMBER DOC_NUMBER,
      d.IDHE_DOC_VER DOC_VER,
      d.IDHE_DOC_PART DOC_PART,
      d.IDHE_IS_SOURCE_OF_A_HEREDITY IS_SOURCE_OF_A_HEREDITY,
      d.IDHE_OVERWRITTEN_INHERITED_REC OVERWRITTEN_INHERITED_REC,
      d.IDHE_EXCLUDED_INHERITED_RECORD EXCLUDED_INHERITED_RECORD,
      d.IDHE_RECNO_TEMPLATE RECNO_TEMPLATE,
      d.IDHE_REF_RECNRI_SOURCE REF_RECNRI_SOURCE,
      d.IDHE_REF_RECNRI_ORIGINAL REF_RECNRI_ORIGINAL,
      d.IDHE_RECNO_ROOT_ORIGINAL RECNO_ROOT_ORIGINAL,
      d.IDHE_TEMPLATE_SEQUENCE TEMPLATE_SEQUENCE,
      d.IDHE_FORMAT_FLAG FORMAT_FLAG,
      nvl(d.IDHE_COPIED, d.SUHE_COPIED) IDHE_COPIED,
      d.IDLT_TEXT_LINE TEXT_LINE
  from saifty_1_staging.STA_V_LOGIC_IDENTIFIER D
  left outer join (
      select
          SUHE_SYSTEM, SUHE_SUBSTANCE, IDHE_ID_TYPE, IDHE_ID_CATEGRY, IDHE_LANGU_ISO, IDHE_SEQUENCE,
          max(IDHE_CHANGD_ON) IDHE_CHANGD_ON
        from saifty_1_staging.STA_V_LOGIC_IDENTIFIER
        group by SUHE_SYSTEM, SUHE_SUBSTANCE, IDHE_ID_TYPE, IDHE_ID_CATEGRY, IDHE_LANGU_ISO, IDHE_SEQUENCE
    ) N
    on (D.SUHE_SYSTEM = N.SUHE_SYSTEM and
        D.SUHE_SUBSTANCE = N.SUHE_SUBSTANCE and
        D.IDHE_ID_TYPE = N.IDHE_ID_TYPE and
        D.IDHE_ID_CATEGRY = N.IDHE_ID_CATEGRY and
        D.IDHE_LANGU_ISO = N.IDHE_LANGU_ISO and
        D.IDHE_SEQUENCE = N.IDHE_SEQUENCE and
        D.IDHE_CHANGD_ON = N.IDHE_CHANGD_ON);

drop table saifty_1_staging.STA_USE_IDENTIFIER;

create table saifty_1_staging.STA_USE_IDENTIFIER
as
select * from saifty_1_staging.STA_V_USE_IDENTIFIER;

drop view ehs_null_tables.sta_v_null_ident_header;
drop view saifty_1_staging.STA_V_CLEAN_IDENT_HEADER;
drop view saifty_1_staging.STA_V_SOURCE_IDENT_HEADER;
drop view ehs_null_tables.sta_v_null_sub_header;
drop view saifty_1_staging.STA_V_CLEAN_SUB_HEADER;
drop view saifty_1_staging.STA_V_SOURCE_SUB_HEADER;
drop view ehs_null_tables.sta_v_null_ident_longtext;
drop view saifty_1_staging.STA_V_CLEAN_IDENT_LONGTEXT;
drop view saifty_1_staging.STA_V_SOURCE_IDENT_LONGTEXT;
drop view ehs_null_tables.sta_v_null_prop_usage;
drop view saifty_1_staging.sta_v_clean_prop_usage;
drop view saifty_1_staging.sta_v_source_prop_usage;
drop view saifty_1_staging.STA_V_TMP_IDENTIFIER;
drop view saifty_1_staging.STA_V_LOGIC_IDENTIFIER;
drop view saifty_1_staging.STA_V_USE_IDENTIFIER